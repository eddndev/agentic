---
import "../styles/global.css";
---

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <title>Login | Agentic</title>
    </head>
    <body
        class="bg-wa-bg-deep min-h-screen flex items-center justify-center font-sans text-wa-text-primary antialiased relative overflow-hidden"
    >
        <!-- Login Container -->
        <main class="w-full max-w-md p-4 sm:p-8 relative z-10" x-data="loginForm">
            <!-- Header -->
            <div class="mb-12 text-center">
                <h1 class="text-3xl sm:text-4xl font-bold tracking-tight mb-2">
                    Agentic <span
                        class="text-wa-green text-xs tracking-wide align-top"
                        >ID</span
                    >
                </h1>
                <p
                    class="text-xs text-wa-text-secondary"
                >
                    Authorized Personnel Only
                </p>
            </div>

            <!-- Form -->
            <form @submit.prevent="submit" class="space-y-6 relative">
                <div
                    class="p-4 sm:p-8 bg-wa-bg-panel border border-wa-border rounded-xl relative"
                >
                    <!-- Error Message -->
                    <div
                        x-show="errorMessage"
                        x-transition
                        class="mb-6 p-3 border border-red-500/30 bg-red-500/10 text-red-200 text-xs text-center rounded-lg"
                    >
                        <span x-text="errorMessage"></span>
                    </div>

                    <!-- Email -->
                    <div class="space-y-2">
                        <label
                            class="text-xs text-wa-text-secondary"
                            >Email</label
                        >
                        <input
                            type="email"
                            x-model="email"
                            class="w-full bg-wa-bg-hover border border-wa-border text-white p-3 text-sm rounded-lg focus:border-wa-green/50 focus:outline-none focus:ring-1 focus:ring-wa-green/50 transition-all placeholder:text-white/20"
                            placeholder="admin@agentic.com"
                            required
                        />
                    </div>

                    <!-- Password -->
                    <div class="space-y-2 mt-6">
                        <label
                            class="text-xs text-wa-text-secondary"
                            >Password</label
                        >
                        <input
                            type="password"
                            x-model="password"
                            class="w-full bg-wa-bg-hover border border-wa-border text-white p-3 text-sm rounded-lg focus:border-wa-green/50 focus:outline-none focus:ring-1 focus:ring-wa-green/50 transition-all placeholder:text-white/20"
                            placeholder="••••••••"
                            required
                        />
                    </div>

                    <!-- Submit -->
                    <button
                        type="submit"
                        class="w-full mt-8 bg-wa-green text-white py-3 text-sm font-semibold rounded-lg hover:bg-wa-green-hover transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                        :disabled="loading"
                    >
                        <span x-show="!loading">Sign In</span>
                        <span x-show="loading" class="animate-pulse"
                            >Verifying...</span
                        >
                    </button>
                </div>
            </form>

            <!-- Footer -->
            <div class="mt-8 text-center">
                <p class="text-[10px] text-wa-text-secondary">
                    Secure Connection &middot; <span class="text-wa-green"
                        >Encrypted</span
                    >
                </p>
            </div>
        </main>

        <script>
            import { ApiClient as api } from "../lib/api";

            // Auth Helpers
            const setToken = (token: string) => localStorage.setItem('token', token);
            const setUser = (user: any) => localStorage.setItem('user', JSON.stringify(user));

            document.addEventListener("alpine:init", () => {
                Alpine.data("loginForm", () => ({
                    email: "",
                    password: "",
                    loading: false,
                    errorMessage: "",

                    async submit() {
                        this.loading = true;
                        this.errorMessage = '';

                        try {
                            const response = await api.post('/auth/login', {
                                email: this.email,
                                password: this.password
                            });

                            if (response.token) {
                                setToken(response.token);
                                setUser(response.user);
                                window.location.href = '/';
                            } else {
                                this.errorMessage = 'Login failed: No token received';
                            }
                        } catch (err) {
                            this.errorMessage = err instanceof Error ? err.message : 'Login failed';
                        } finally {
                            this.loading = false;
                        }
                    }
                }));
            });
        </script>
    </body>
</html>
