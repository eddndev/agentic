---
---

<div
    x-data={`{
    clients: [],
    loading: true,

    get botId() {
        return new URLSearchParams(window.location.search).get('id') || '';
    },

    async fetchClients() {
        if (!this.botId) return;
        this.loading = true;
        try {
            const data = await ApiClient.get('/clients?botId=' + this.botId);
            this.clients = data;
        } catch (e) {
            console.error(e);
        } finally {
            this.loading = false;
        }
    },

    init() {
        this.fetchClients();
    },

    statusColor(status) {
        const map = {
            'REGISTRO_PENDIENTE': 'bg-yellow-500/20 text-yellow-500',
            'PAGO_GOBIERNO_PENDIENTE': 'bg-orange-500/20 text-orange-400',
            'PAGO_GOBIERNO_REALIZADO': 'bg-blue-500/20 text-blue-400',
            'EXAMEN_EN_PROCESO': 'bg-purple-500/20 text-purple-400',
            'LICENCIA_LISTA': 'bg-cyan-500/20 text-cyan-400',
            'COMPLETADO': 'bg-green-500/20 text-green-400',
        };
        return map[status] || 'bg-gray-500/20 text-gray-400';
    }
}`}
>
    <!-- Empty State -->
    <template x-if="!loading && clients.length === 0">
        <div class="text-center py-10 text-gray-500">
            <p>No hay clientes registrados en este bot.</p>
        </div>
    </template>

    <!-- Loading -->
    <template x-if="loading">
        <div class="text-center py-10">
            <span class="text-xs font-mono text-gray-500 uppercase animate-pulse">Cargando...</span>
        </div>
    </template>

    <!-- Table -->
    <div class="overflow-x-auto" x-show="!loading && clients.length > 0">
        <table class="w-full text-left border-collapse">
            <thead>
                <tr class="text-xs uppercase text-gray-400 border-b border-white/10">
                    <th class="p-3">Nombre</th>
                    <th class="p-3">CURP</th>
                    <th class="p-3">Status</th>
                    <th class="p-3">Email</th>
                    <th class="p-3">Tel√©fono</th>
                    <th class="p-3">Registro</th>
                </tr>
            </thead>
            <tbody class="divide-y divide-white/5">
                <template x-for="client in clients" :key="client.id">
                    <tr class="hover:bg-white/5 transition-colors">
                        <td class="p-3 font-medium text-white" x-text="client.name"></td>
                        <td class="p-3 text-gray-400 font-mono text-xs" x-text="client.curp || '-'"></td>
                        <td class="p-3">
                            <span
                                class="px-2 py-1 rounded text-[10px] uppercase font-bold tracking-wide"
                                :class="statusColor(client.status)"
                                x-text="client.status ? client.status.replace(/_/g, ' ') : 'PENDIENTE'"
                            ></span>
                        </td>
                        <td class="p-3 text-gray-400" x-text="client.email"></td>
                        <td class="p-3 text-gray-400" x-text="client.phoneNumber"></td>
                        <td class="p-3 text-gray-500 text-xs" x-text="new Date(client.createdAt).toLocaleDateString()"></td>
                    </tr>
                </template>
            </tbody>
        </table>
    </div>
</div>

<script>
    import { ApiClient } from "../../lib/api";
    window.ApiClient = ApiClient;
</script>
